# üó∫Ô∏è Roadmap: Vietnam GL Engine cho SME (Theo Th√¥ng t∆∞ 133/2016/TT-BTC)

> **M·ª•c ti√™u**: X√¢y d·ª±ng m·ªôt **th∆∞ vi·ªán GL (General Ledger) m·ªü, nh·∫π, tu√¢n th·ªß ph√°p l√Ω Vi·ªát Nam**, d√†nh ri√™ng cho doanh nghi·ªáp nh·ªè v√† v·ª´a (SME).  
> **Nguy√™n t·∫Øc**: Logic nghi·ªáp v·ª• t√°ch bi·ªát, kh√¥ng ph·ª• thu·ªôc DB/UI, d·ªÖ t√≠ch h·ª£p, d·ªÖ m·ªü r·ªông.

---

## üéØ T·ªïng quan

| Giai ƒëo·∫°n | T√™n | M·ª•c ti√™u ch√≠nh | Th·ªùi gian ∆∞·ªõc l∆∞·ª£ng |
|----------|-----|----------------|----------------------|
| **Giai ƒëo·∫°n 0** | Chu·∫©n b·ªã n·ªÅn t·∫£ng | Hi·ªÉu TT 133, thi·∫øt k·∫ø domain model | 1‚Äì3 ng√†y |
| **Giai ƒëo·∫°n 1** | GL c·ªët l√µi | Ghi s·ªï k√©p, qu·∫£n l√Ω s·ªë d∆∞, validate | 1‚Äì2 tu·∫ßn |
| **Giai ƒëo·∫°n 2** | B√°o c√°o t√†i ch√≠nh | Sinh B01-DNN, B02-DNN theo qu√Ω/nƒÉm | 1 tu·∫ßn |
| **Giai ƒëo·∫°n 3** | ƒê√≥ng g√≥i & m·ªü r·ªông | CLI, package, k·∫øt chuy·ªÉn, kh√≥a s·ªï | 1‚Äì2 tu·∫ßn |

> üí° **MVP Scope**: 1 c√¥ng ty, 1 ti·ªÅn t·ªá (VND), kh√¥ng multi-currency, kh√¥ng multi-branch.

---

## üß≠ Giai ƒëo·∫°n 0: Chu·∫©n b·ªã n·ªÅn t·∫£ng

### M·ª•c ti√™u
Hi·ªÉu r√µ nghi·ªáp v·ª• k·∫ø to√°n SME theo Th√¥ng t∆∞ 133 v√† thi·∫øt k·∫ø ki·∫øn tr√∫c domain tr∆∞·ªõc khi code.

### C√°c b∆∞·ªõc c·∫ßn l√†m
1. **Nghi√™n c·ª©u Th√¥ng t∆∞ 133/2016/TT-BTC**
   - T·∫≠p trung v√†o:
     - H·ªá th·ªëng t√†i kho·∫£n (Ph·ª• l·ª•c 1)
     - M·∫´u b√°o c√°o B01-DNN, B02-DNN (Ph·ª• l·ª•c 4)
     - Nguy√™n t·∫Øc ghi s·ªï k√©p, k·∫øt chuy·ªÉn cu·ªëi nƒÉm
   - Link: [Th√¥ng t∆∞ 133 - B·ªô T√†i ch√≠nh](https://thuvienphapluat.vn/van-ban/Thue-Phi-Le-Phi/Thong-tu-133-2016-TT-BTC-che-do-ke-toan-doanh-nghiep-nho-va-vua-330375.aspx)

2. **X√°c ƒë·ªãnh ph·∫°m vi MVP**
   - Ch·ªâ h·ªó tr·ª£:
     - 1 c√¥ng ty
     - 1 ƒë∆°n v·ªã ti·ªÅn t·ªá (VND)
     - B√°o c√°o theo qu√Ω/nƒÉm theo TT 133

3. **Thi·∫øt k·∫ø Domain Model**
   - C√°c th·ª±c th·ªÉ ch√≠nh:
     - `Account`
     - `JournalEntry` / `JournalLine`
     - `Ledger`
     - `TrialBalance`
   - ‚Üí V·∫Ω s∆° ƒë·ªì class (d√π b·∫±ng tay ho·∫∑c [draw.io](https://draw.io))

4. **Chu·∫©n b·ªã c·∫•u h√¨nh m·∫´u**
   - T·∫°o file `config/tt133_coa.yaml` (to√†n b·ªô t√†i kho·∫£n theo TT 133)
   - T·∫°o file `config/reports/b01_dnn.yaml`, `b02_dnn.yaml` (mapping b√°o c√°o)

### C·ªôt m·ªëc ho√†n th√†nh
- [ ] C√≥ file `tt133_coa.yaml` ƒë·∫ßy ƒë·ªß
- [ ] C√≥ s∆° ƒë·ªì class domain model

---

## ‚öôÔ∏è Giai ƒëo·∫°n 1: X√¢y d·ª±ng GL c·ªët l√µi

### M·ª•c ti√™u
H·ªá th·ªëng c√≥ th·ªÉ **ghi s·ªï k√©p h·ª£p l·ªá** v√† **theo d√µi s·ªë d∆∞ t·ª´ng t√†i kho·∫£n** (in-memory).

### C√°c b∆∞·ªõc c·∫ßn l√†m (theo th·ª© t·ª±)

1. **X√¢y d·ª±ng `Account` v√† `AccountChart`**
   - Load COA t·ª´ YAML ‚Üí dict `{code: Account}`
   - H·ªó tr·ª£ tra c·ª©u theo m√£

2. **X√¢y d·ª±ng `JournalLine` v√† `JournalEntry`**
   - M·ªói d√≤ng ch·ªâ c√≥ **N·ª£ ho·∫∑c C√≥**
   - Entry ch·ª©a nhi·ªÅu d√≤ng

3. **Vi·∫øt validator cho nguy√™n t·∫Øc k√©p**
   - T·ªïng N·ª£ = T·ªïng C√≥
   - T·∫•t c·∫£ t√†i kho·∫£n ph·∫£i t·ªìn t·∫°i trong COA

4. **X√¢y d·ª±ng `Ledger`**
   - L∆∞u s·ªë d∆∞: `{account_code: {debit: ..., credit: ...}}`
   - Ph∆∞∆°ng th·ª©c `.post(entry)` ‚Üí c·∫≠p nh·∫≠t s·ªë d∆∞ n·∫øu h·ª£p l·ªá

5. **Vi·∫øt unit test**
   - Test giao d·ªãch h·ª£p l·ªá ‚Üí pass
   - Test giao d·ªãch kh√¥ng c√¢n b·∫±ng ‚Üí raise error
   - Test t√†i kho·∫£n kh√¥ng t·ªìn t·∫°i ‚Üí raise error

### C·ªôt m·ªëc ho√†n th√†nh (M1)
- [ ] Ghi ƒë∆∞·ª£c 1 journal h·ª£p l·ªá v√† xem s·ªë d∆∞ t√†i kho·∫£n
- [ ] 100% unit test pass

---

## üìä Giai ƒëo·∫°n 2: Sinh b√°o c√°o t√†i ch√≠nh

### M·ª•c ti√™u
T·ª´ s·ªë d∆∞ trong `Ledger`, t·ª± ƒë·ªông t·∫°o **B·∫£ng c√¢n ƒë·ªëi k·∫ø to√°n (B01-DNN)** v√† **K·∫øt qu·∫£ HƒêKD (B02-DNN)** theo qu√Ω/nƒÉm.

### C√°c b∆∞·ªõc c·∫ßn l√†m

1. **X√¢y d·ª±ng `TrialBalance`**
   - T·ªïng h·ª£p s·ªë d∆∞ t·∫•t c·∫£ t√†i kho·∫£n t·∫°i m·ªôt th·ªùi ƒëi·ªÉm

2. **Thi·∫øt k·∫ø c∆° ch·∫ø mapping b√°o c√°o**
   - D√πng file YAML ƒë·ªÉ ƒë·ªãnh nghƒ©a:
     - D√≤ng b√°o c√°o ‚Üî danh s√°ch t√†i kho·∫£n
     - D·∫•u (+/-) d·ª±a tr√™n `normal_balance`

3. **Vi·∫øt h√†m b√°o c√°o**
   - `generate_balance_sheet(ledger, period)`
   - `generate_income_statement(ledger, period)`

4. **H·ªó tr·ª£ l·ªçc theo k·ª≥**
   - Helper: `get_quarter("2025-04-15") ‚Üí "2025-Q2"`

5. **Xu·∫•t b√°o c√°o ra dict/JSON**
   - Ch∆∞a c·∫ßn PDF ‚Äî t·∫≠p trung v√†o **d·ªØ li·ªáu ƒë√∫ng**

### C·ªôt m·ªëc ho√†n th√†nh (M2)
- [ ] B√°o c√°o B01-DNN hi·ªÉn th·ªã ƒë√∫ng s·ªë ti·ªÅn (d√π ch·ªâ 2 t√†i kho·∫£n)
- [ ] C√≥ th·ªÉ sinh b√°o c√°o cho qu√Ω I, II, III, IV

---

## üì¶ Giai ƒëo·∫°n 3: ƒê√≥ng g√≥i & m·ªü r·ªông

### M·ª•c ti√™u
Bi·∫øn th∆∞ vi·ªán th√†nh **s·∫£n ph·∫©m c√≥ th·ªÉ d√πng ƒë∆∞·ª£c** trong th·ª±c t·∫ø.

### C√°c b∆∞·ªõc c·∫ßn l√†m

1. **X·ª≠ l√Ω k·ª≥ k·∫ø to√°n & s·ªë d∆∞ ƒë·∫ßu k·ª≥**
   - L∆∞u balances theo k·ª≥
   - T√≠nh s·ªë d∆∞ ƒë·∫ßu k·ª≥ = s·ªë d∆∞ cu·ªëi k·ª≥ tr∆∞·ªõc

2. **K·∫øt chuy·ªÉn cu·ªëi nƒÉm**
   - T·ª± ƒë·ªông t·∫°o journal k·∫øt chuy·ªÉn:
     - Doanh thu (511...) ‚Üí C√≥ 421
     - Chi ph√≠ (632, 641...) ‚Üí N·ª£ 421

3. **Kh√≥a k·ª≥ k·∫ø to√°n (Period Locking)**
   - NgƒÉn ghi s·ªï v√†o k·ª≥ ƒë√£ ch·ªët (d√π ch·ªâ in-memory)

4. **X√¢y d·ª±ng CLI tool ƒë∆°n gi·∫£n**
   ```bash
   gl-cli post --file sale.json
   gl-cli report --type B01-DNN --period 2025-Q2
